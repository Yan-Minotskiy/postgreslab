# Практика №4 - Работа с транзакциями

**Работы в рамках дисциплины:**

[Клиент-серверные системы управления базами данных](../README.md) 

**Предыдущая работа:**

[Практика №3 - Администрирование](./Практика%20№3%20-%20Администрирование.md) 

**Следующая работа:**

[Практика №5 - Работа с группами ролей и ролями](./Практика%20№5%20-%20Работа%20с%20группами%20ролей%20и%20ролями.md)

**Полезная статья на тему транзакций, на основе которой была выполнена работа:**

[Уровни изоляции транзакций с примерами на PostgreSQL](https://m.habr.com/ru/post/317884/)

---

## Задание

В [реализованную по выбору базу данных](./Практика%20№3%20-%20Администрирование.md) добавить 3 уникальные транзакции, одна из которых должна выводить ошибку любого уровня исключения(например, "грязное чтение" или фантомное чтение)

## Ход работы

1. Сделали 4 подключения и в каждом открыли по транзакции.

![](../image/p4-1.png)

2. В начальный момент всем транзакциям доступна изначальная версия данных.

![](../image/p4-2.png)

3. В первой транзакции обновили данные, но это обновление видно только ей, в остальных транзакциях обновление **НЕ** видно.

![](../image/p4-3.png)

![](../image/p4-4.png)

4. Как только закрываем первую транзакцию, сразу обновления доступны остальным транзакциям.

![](../image/p4-5.png)

5. Обновление данных во второй транзакции блокирует другие изменения, например, в третьей транзакции.

![](../image/p4-6.png)

6. Несмотря на то, что третья транзакция ожидает закрытия второй, четвертая и вторая прекрасно функционируют.

![](../image/p4-7.png)

7. Закрытие второй транзакции приводит к разблокированию данных для изменения.

![](../image/p4-8.png)

8. До закрытия третьей транзакции, данные будут удалёнными только внутри третьей транзакции. 

![](../image/p4-9.png)

9.  Закрытие третьей транзакции, как следствие возникает фантомное чтение, т. е. транзакция повторно выполняет запрос, возвращающий набор строк для этого же условия, и обнаруживает, что набор строк, удовлетворяющих условию, изменился из-за транзакции, завершившейся за это время.

![](../image/p4-10.png)
